<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hotel.cloud.modules.agent.dao.AgentUserDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.hotel.cloud.modules.agent.entity.AgentUserEntity" id="agentUserMap">
        <result property="userId" column="user_id"/>
        <result property="agentName" column="agent_name"/>
        <result property="area" column="area"/>
        <result property="address" column="address"/>
        <result property="remark" column="remark"/>
        <association property="sysUser" javaType="com.hotel.cloud.modules.sys.entity.SysUserEntity">
            <result property="username" column="username"/>
            <result property="email" column="email"/>
            <result property="mobile" column="mobile"/>
            <result property="createTime" column="create_time"/>
            <result property="agentLevel" column="agent_level"/>
            <result property="parentId" column="parent_id"/>
            <result property="parentName" column="parent_name"/>
            <result property="contactPerson" column="contact_person"/>
            <result property="status" column="status"/>
        </association>
    </resultMap>

    <select id="getAgentUserList" resultMap="agentUserMap">
        select t.*,au.agent_name parent_name from (select u.*,s.username,s.email,s.mobile,s.create_time,s.agent_level,s.parent_id,s.contact_person,s.status,s.flag
        from t_agent_user u
        inner join sys_user s
		on u.user_id = s.user_id) t
		left join t_agent_user au
		on t.parent_id = au.user_id
		where t.agent_level > 0 and t.flag = 1
		<if test="params.agentSelect == true">
            and t.agent_level &lt; 3
        </if>
        <if test="params.username != null and params.username != ''">
            and t.username like CONCAT(CONCAT('%', #{params.username}), '%')
        </if>
        <if test="params.agentName != null and params.agentName != ''">
            and t.agent_name like CONCAT(CONCAT('%', #{params.agentName}), '%')
        </if>
        <if test="params.parentName != null and params.parentName != ''">
            and au.agent_name like CONCAT(CONCAT('%', #{params.parentName}), '%')
        </if>
        <if test="params.parentId != null">
            and t.parent_id = #{params.parentId}
        </if>
        <if test="params.agentLevels != null and params.agentLevels.size() > 0">
            and t.agent_level in
            <foreach collection="params.agentLevels" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="params.status != null">
            and t.status = #{params.status}
        </if>
        order by t.agent_level asc, t.create_time desc
    </select>

    <select id="getAgentUser" resultMap="agentUserMap">
        select t.*,au.agent_name parent_name from (select u.*,s.username,s.email,s.mobile,s.create_time,s.agent_level,s.parent_id,s.contact_person,s.status,s.flag
        from t_agent_user u
        inner join sys_user s
        on u.user_id = s.user_id) t
        left join t_agent_user au
        on t.parent_id = au.user_id
        where t.user_id = #{id} and t.flag = 1
    </select>


</mapper>